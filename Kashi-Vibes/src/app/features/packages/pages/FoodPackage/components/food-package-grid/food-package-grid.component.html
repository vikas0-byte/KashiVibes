<section class="py-12 px-4">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      
      <!-- Filters Sidebar -->
      @if (config.showFilters) {
        <div class="lg:col-span-1">
          <div class="rounded-lg border bg-card text-card-foreground shadow-sm sticky top-4 p-6">
            <div class="flex items-center gap-2 mb-6">
              <lucide-icon [name]="filterIcon" class="w-5 h-5 text-primary"></lucide-icon>
              <h3 class="font-bold text-xl" [ngStyle]="{'font-family': 'var(--font-heading)'}">Filters</h3>
              <app-badge variant="secondary" class="ml-auto">
                {{ totalSpots() }} spots
              </app-badge>
            </div>
            
            <!-- Search Box -->
            <div class="mb-6">
              <div class="relative">
                <lucide-icon [name]="searchIcon" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground "></lucide-icon>
                <input
                  type="text"
                  [value]="searchQuery()"
                  (input)="handleSearchInput($event)"
                  placeholder="Search food spots..."
                  class="w-full pl-10 pr-4 py-2 outline-none rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent ml-2"
                />
              </div>
            </div>

            <div class="space-y-6">
              <!-- Price Range -->
              @if (config.showPriceFilter) {
                <div>
                  <label class="block text-sm font-semibold mb-3">
                    Price Range
                  </label>
                  <div class="mb-2 text-lg font-bold text-primary">
                    {{ priceRangeDisplay() }}
                  </div>
                  <app-slider
                    [value]="[currentFilters().priceRange[0], currentFilters().priceRange[1]]"
                    (valueChange)="onPriceRangeChange($event)"
                    [max]="200"
                    [min]="20"
                    [step]="10"
                    class="w-full"
                  ></app-slider>
                </div>
              }

              <app-separator></app-separator>
              
              <!-- Food Type -->
              @if (config.showTypeFilter) {
                <div>
                  <label class="block text-sm font-semibold mb-3">Food Type</label>
                  <app-select [value]="currentFilters().selectedType" (valueChange)="onTypeChange($event)">
                    <app-select-trigger>
                      <app-select-value [placeholder]="'All Types'"></app-select-value>
                    </app-select-trigger>
                    <app-select-content>
                      @for (type of foodTypes; track type) {
                        <app-select-item [value]="type.toLowerCase()">{{ type }}</app-select-item>
                      }
                    </app-select-content>
                  </app-select>
                </div>
              }

              <app-separator></app-separator>
              
              <!-- Difficulty Level -->
              @if (config.showDifficultyFilter) {
                <div>
                  <label class="block text-sm font-semibold mb-3">Difficulty Level</label>
                  <app-select [value]="currentFilters().selectedDifficulty" (valueChange)="onDifficultyChange($event)" class="w-full">
                    <app-select-trigger class="w-full">
                      <app-select-value [placeholder]="'All Levels'"></app-select-value>
                    </app-select-trigger>
                    <app-select-content class="w-full">
                      @for (level of difficultyLevels; track level) {
                        <app-select-item [value]="level.toLowerCase()" class="w-full">{{ level }}</app-select-item>
                      }
                    </app-select-content>
                  </app-select>
                </div>
              }

              <app-separator></app-separator>

              <!-- Additional Filters -->
              <div class="space-y-3">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    [checked]="currentFilters().featuredOnly"
                    (change)="onFeaturedToggle()"
                    class="rounded border-gray-300 text-primary focus:ring-primary"
                  />
                  <span class="text-sm font-medium">Featured Only</span>
                </label>
              </div>

              <app-separator></app-separator>
              
              <!-- Filter Buttons -->
              <div class="space-y-2 flex justify-center">
                <app-button (click)="resetFilters()" variant="ghost">
                  Reset All Filters
                </app-button>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Food Spots Grid -->
      <div [class]="config.showFilters ? 'lg:col-span-3' : 'lg:col-span-4'">
        
        <!-- Results Header -->
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-gray-900">
            {{ totalSpots() }} Food Spots Found
          </h2>
          <p class="text-gray-600 mt-1">
            Discover amazing food experiences in Varanasi
          </p>
        </div>

        <!-- Food Spots Grid -->
        @if (displayedSpots().length > 0) {
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            @for (spot of displayedSpots(); track trackByFoodSpotId($index, spot); let index = $index) {
              <div 
                class="group overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-2 animate-fade-in rounded-lg border bg-card text-card-foreground shadow-sm"
                [style.animation-delay]="index * 0.1 + 's'" [ngStyle]="{ 'box-shadow': 'var(--shadow-md)' }"
              >
                <div class="relative h-48 overflow-hidden">
                  <img 
                    [src]="spot.image" 
                    [alt]="spot.name"
                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                  />
                  <div class="absolute top-3 right-3 flex flex-col gap-2">
                    <app-badge class="bg-primary text-primary-foreground shadow-lg">
                      â‚¹{{ spot.price }}
                    </app-badge>
                    <div class="flex items-center gap-1 bg-white rounded-full px-2 py-1 shadow-lg">
                      <lucide-icon [name]="starIcon" class="w-3 h-3 fill-yellow-400 text-yellow-400"></lucide-icon>
                      <span class="text-xs font-bold">{{ spot.rating }}</span>
                    </div>
                  </div>

                  <!-- Featured Badge -->
                  @if (spot.featured) {
                    <div class="absolute bottom-3 left-3">
                      <app-badge class="bg-yellow-500 text-white text-xs">
                        Featured
                      </app-badge>
                    </div>
                  }
                </div>

                <div class="p-4">
                  <h3 class="text-lg font-bold mb-2 line-clamp-1" [ngStyle]="{'font-family': 'var(--font-heading)'}">
                    {{ spot.name }}
                  </h3>
                  
                  <div class="flex items-center gap-2 mb-3">
                    <app-badge variant="secondary" class="text-xs">
                      {{ spot.type }}
                    </app-badge>
                    <app-badge 
                      variant="outline" 
                      [className]="getDifficultyBadgeClass(spot.difficulty) + ' text-xs'"
                    >
                      {{ spot.difficulty }}
                    </app-badge>
                    <app-badge 
                      [className]="getCrowdBadgeClass(spot.crowd) + ' text-xs'"
                    >
                      {{ spot.crowd }} Crowd
                    </app-badge>
                  </div>

                  <p class="text-muted-foreground text-sm mb-3 line-clamp-2">
                    {{ spot.description }}
                  </p>

                  <div class="space-y-2 mb-3 text-xs">
                    <div class="flex items-center gap-2 text-muted-foreground">
                      <lucide-icon [name]="mapPinIcon" class="w-3 h-3"></lucide-icon>
                      <span class="line-clamp-1">{{ spot.location }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-muted-foreground">
                      <lucide-icon [name]="clockIcon" class="w-3 h-3"></lucide-icon>
                      <span class="line-clamp-1">{{ spot.timings }}</span>
                    </div>
                  </div>

                  <app-separator class="my-3"></app-separator>

                  <div>
                    <h4 class="font-semibold text-xs mb-2">Must Try:</h4>
                    <div class="flex flex-wrap gap-1">
                      @for (item of spot.mustTry.slice(0, 2); track trackByMustTry($index, item); let idx = $index) {
                        <app-badge variant="outline" class="text-xs">
                          {{ item }}
                        </app-badge>
                      }
                      @if (spot.mustTry.length > 2) {
                        <app-badge variant="outline" class="text-xs">
                          +{{ spot.mustTry.length - 2 }}
                        </app-badge>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        } @else {
          <!-- No Results -->
          <div class="text-center py-12">
            <div class="w-24 h-24 mx-auto mb-4 bg-foreground rounded-full flex items-center justify-center">
              <lucide-icon [name]="searchIcon" class="w-12 h-12 text-foreground"></lucide-icon>
            </div>
            <h3 class="text-lg font-bold text-muted-foreground mb-2">No food spots found</h3>
            <p class="text-muted-foreground mb-6">
              Try adjusting your filters or search terms
            </p>
            <app-button (click)="resetFilters()" [ngStyle]="{ 'background': 'var(--gradient-primary)' }">
              Reset All Filters
            </app-button>
          </div>
        }

        <!-- Pagination -->
        @if (config.enablePagination && totalPages() > 1) {
          <div class="flex justify-center items-center gap-2 mt-8">
            <app-button
              (click)="prevPage()"
              [disabled]="currentPage() === 1"
              variant="outline"
              size="sm"
            >
              Previous
            </app-button>

            <div class="flex gap-1">
              @for (page of pagesArray(); track trackByPage($index, page)) {
                <button
                  (click)="goToPage(page)"
                  [class]="currentPage() === page 
                    ? 'bg-primary text-white' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                  class="w-8 h-8 rounded text-sm font-medium transition-colors"
                >
                  {{ page }}
                </button>
              }
            </div>

            <app-button
              (click)="nextPage()"
              [disabled]="currentPage() === totalPages()"
              variant="outline"
              size="sm"
            >
              Next
            </app-button>
          </div>
        }
      </div>
    </div>
  </div>
</section>